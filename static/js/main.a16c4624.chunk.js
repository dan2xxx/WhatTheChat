(this.webpackJsonpethchat=this.webpackJsonpethchat||[]).push([[0],{205:function(e,n,t){},207:function(e,n,t){},220:function(e,n){},229:function(e,n){},247:function(e,n){},249:function(e,n){},265:function(e,n){},266:function(e,n){},329:function(e,n){},331:function(e,n){},340:function(e,n){},342:function(e,n){},367:function(e,n){},369:function(e,n){},370:function(e,n){},375:function(e,n){},377:function(e,n){},39:function(e,n,t){e.exports={container:"Chat_container__1Ewyf",inputForm:"Chat_inputForm__3_Bjc",nameInput:"Chat_nameInput__1wO07",textInput:"Chat_textInput__1X8c0",message:"Chat_message__2rHLj",feed:"Chat_feed__23_Os"}},390:function(e,n){},402:function(e,n){},405:function(e,n){},410:function(e,n){},421:function(e,n){},424:function(e,n){},477:function(e,n,t){"use strict";t.r(n);var a=t(15),s=t.n(a),i=t(196),c=t.n(i),r=(t(205),t(21)),u=t.n(r),o=t(104),l=t(38),p=(t(207),t(105)),f=t.n(p),d=t(39),m=t.n(d),g=t(11),h=function(e){var n=s.a.useState(""),t=Object(l.a)(n,2),a=t[0],i=t[1],c=s.a.useState(""),r=Object(l.a)(c,2),u=r[0],o=r[1],p=s.a.useRef(),f=function(e){var n=new Date(1e3*e),t=n.getHours(),a="0"+n.getMinutes(),s="0"+n.getSeconds();return t+":"+a.substr(-2)+":"+s.substr(-2)};return s.a.useEffect((function(){p.current.scrollTop=p.current.scrollTop+(p.current.scrollHeight-p.current.clientHeight)}),[e.messages]),Object(g.jsxs)("div",{className:m.a.container,children:[Object(g.jsx)("h1",{children:"What the chat?"}),Object(g.jsx)("div",{className:m.a.feed,ref:p,children:function(){if(e.messages)return e.messages.map((function(e,n){return Object(g.jsxs)("div",{className:m.a.message,children:[f(e.timestamp)," ",Object(g.jsx)("span",{style:{fontWeight:"700"},children:e.name})," : ",e.message]},n)}))}()}),Object(g.jsxs)("div",{className:m.a.inputForm,children:[Object(g.jsx)("input",{className:m.a.nameInput,onChange:function(e){return i(e.target.value)},value:a,placeholder:"Your name"}),Object(g.jsx)("input",{className:m.a.textInput,onChange:function(e){return o(e.target.value)},value:u,placeholder:"Enter message"}),Object(g.jsx)("button",{onClick:function(){e.addMessage(a,u),i(""),o("")},children:"Send"})]})]})},b=[{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"},{indexed:!1,internalType:"string",name:"message",type:"string"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"NewMessage",type:"event"},{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"string",name:"_message",type:"string"}],name:"addMessage",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"messages",outputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"message",type:"string"},{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"messagesLength",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"_name",type:"string"}],name:"register",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"users",outputs:[{internalType:"address",name:"accountAddress",type:"address"},{internalType:"string",name:"userName",type:"string"},{internalType:"string",name:"status",type:"string"}],stateMutability:"view",type:"function"}];function y(e){var n=s.a.useState([]),t=Object(l.a)(n,2),a=t[0],i=t[1],c=s.a.useState(null),r=Object(l.a)(c,2),p=r[0],f=r[1],d=function(){var e=Object(o.a)(u.a.mark((function e(n){var t,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.methods.messagesLength().call();case 2:t=e.sent,a=[],s=0;case 5:if(!(s<t)){e.next=15;break}return e.t0=a,e.next=9,n.methods.messages(s).call();case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),console.log(a);case 12:s++,e.next=5;break;case 15:i(a);case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),m=function(){var n=Object(o.a)(u.a.mark((function n(t,a){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.web3.eth.getAccounts().then((function(n){console.log(e.web3.eth),n.length>0&&p.methods.addMessage(t,a).send({from:"".concat(n)})}));case 1:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return s.a.useEffect((function(){if(b){var n=new e.web3.eth.Contract(b,"0x7896E010042efD99dCB76C3f150156C1544C4030");f(n),d(n).then(console.log("messages collected"))}var t=e.web3.eth.subscribe("logs",{address:"0x7896E010042efD99dCB76C3f150156C1544C4030",topics:["0xd139c8de132b273212c7748176bea519724854faab652bbd83b7967a75f1ac0f"]},(function(e,t){e||console.log(t),console.log("Reload messages"),d(n)})).on("connected",(function(e){console.log(e)})).on("data",(function(e){console.log(e)})).on("changed",(function(e){}));console.log(t)}),[e.web3]),Object(g.jsx)("div",{className:"App",children:a.length>0?Object(g.jsx)(h,{messages:a,addMessage:m}):Object(g.jsx)("h1",{children:"Initializing..."})})}var j=function(){var e=s.a.useState(null),n=Object(l.a)(e,2),t=n[0],a=n[1];return s.a.useEffect((function(){if(window.ethereum){window.ethereum.enable();var e=new f.a(window.ethereum);a(e),console.log("Provider: metamask")}else{var n=new f.a("wss://rinkeby.infura.io/ws/v3/5bdef920720a4ae9bc517ee52259b412");a(n),console.log("Provider: infura")}}),[]),Object(g.jsxs)("div",{children:[console.log(t),t?Object(g.jsx)(y,{web3:t}):null]})},v=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,481)).then((function(n){var t=n.getCLS,a=n.getFID,s=n.getFCP,i=n.getLCP,c=n.getTTFB;t(e),a(e),s(e),i(e),c(e)}))};c.a.render(Object(g.jsx)(s.a.StrictMode,{children:Object(g.jsx)(j,{})}),document.getElementById("root")),v()}},[[477,1,2]]]);
//# sourceMappingURL=main.a16c4624.chunk.js.map